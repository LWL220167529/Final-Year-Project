<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Plan Your Next Adventure</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Roboto+Condensed&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/planform.css">
  <script src="https://kit.fontawesome.com/298191de6e.js" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDb4iE2zwfaw7lxIavF6cTt4sjoiM4cDGc&libraries=places"></script>
</head>

<header class = "header">
    <img class  = "logo" src = "">
    <nav>
       <ul class = "nav_links">
           <li><a href = "index.html">Home</a></li>
           <li><a href = "planForm.html">Start Planning</a></li>
           <li><a href = "savedPlan.html">Saved Plan</a></li>
           <a class = "cta" href = "index.html"><button>Logout</button></a>
    </nav>
   
</header>

<body>
 <br>
 <br>
 <br>
 <div class="container my-10">
    <div class="">
        <div class="w-55 mx-auto">
            <form class="" >
                <div>
                    <div class="my-5">
                        <h4>What is your destination of choice?</h4> <!-- Corrected the closing tag -->
                    </div>
                    <div>
                        <input class="shadow-sm form-control form-control-lg w-100" list="placeList" type="text"
                            id="input_place" name="city" placeholder="Input a city" />
                        <datalist id="placeList">
                        </datalist>
                    </div>
                </div>
                <br>
                <br>
                <br>
      <div class="mb-5">
        <label for="start">Starting Date:</label>
        <input type="date" id="startDate" name="tripStartDate"
               value="2024-01-11" min="" max="2024-12-31" class="form-control" />
      </div>
      <div class="mb-5">
        <label for="numDays" class="form-label">How many days are you planning to travel?</label>
        <div class="input-group">
          
          <input type="number" class="form-control" id="numDays" value="5" min = "1" max = "14">
        
        </div>
      </div>
      <div class="mb-5">
        <label for="peopleCount" class="form-label">How many people are going?</label>
        <div class="input-group">
          <input type="number" class="form-control text-center" value="1" min = "1" id="peopleCount">
        </div>
      </div>
      <div class="mb-5">
       <label for="selectBudget" class="form-label">How much do you plan on spending during the trip?</label>
      <select class="form-select form-select-sm" id="budgetSelect">
        <option selected>Select a budget ($USD)</option>
        <option value="Low">Below $1000 (Low)</option>
        <option value="Medium">$1000 - $2500 (Mid)</option>
        <option value="High">Above $2500 (High)</option>
      </select>
     </div>
     <div class="container mt-3 mb-5">
        <label for="peopleCount" class="form-label">What activities you would like to do during your trip? (Select one or more)</label>
        <div class="row mb-3">
          <div class="col-md-4">
            <div class="activity-box" data-activity="beaches">
               <p>Beaches</p>
               <i class="fa-solid fa-umbrella-beach fa-2xl"></i>
           </div>
          </div>
         <div class="col-md-4">
           <div class="activity-box" data-activity="city-sightseeing">
              <p>Sightseeing</p>
               <i class="fa-solid fa-camera-retro fa-2xl"></i>
           </div>
         </div>
        <div class="col-md-4">
           <div class="activity-box" data-activity="shopping">
           <p>Shopping</p>
          <i class="fa-solid fa-cart-shopping fa-2xl"></i>
          </div>
        </div>
       </div> <!-- Closing the first row here -->
       
        <div class="row mb-3"> <!-- Starting a new row -->
          <div class="col-md-4">
            <div class="activity-box" data-activity="food-exploration">
              <p>Food exploration</p>
              <i class="fa-solid fa-utensils fa-2xl"></i>
            </div>
          </div>
          <div class="col-md-4">
            <div class="activity-box" data-activity="night-life">
              <p>Night Life</p>
              <i class="fa-solid fa-martini-glass fa-2xl"></i>
            </div>
          </div>
          <div class="col-md-4">
            <div class="activity-box" data-activity="outdoor-activities">
              <p>Outdoor activities</p>
              <i class="fa-solid fa-person-hiking fa-2xl"></i>
            </div>
          </div>
        </div> <!-- Closing the second row -->
      </div>
    </form>
    <div >
      <button class="btn btn-primary" onclick="handleSubmit()">Create New Trip</button>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
       var destinationlattitude, destinationllongttitude;
       var neLatitude, neLongitude, swLatitude, swLongitude;


       document.getElementById("startDate").min = new Date().toISOString().split("T")[0];

        
              function initAutocomplete() {
                  var autocomplete = new google.maps.places.Autocomplete(
                      document.getElementById('input_place'), { types: ['geocode'] }
                  );

                  autocomplete.addListener('place_changed', function () {
                      var place = autocomplete.getPlace();
                      if (!place.geometry) {
                          console.log("Returned place contains no geometry");
                          return;
                      }
                      var location = place.geometry.location;
                      var viewport = place.geometry.viewport;
                      var ne = viewport.getNorthEast(); // northeast corner of the viewport
                      var sw = viewport.getSouthWest(); // southwest corner of the viewport

                      neLatitude = ne.lat();
                      neLongitude = ne.lng();
                      swLatitude = sw.lat();
                      swLongitude = sw.lng();
                      destinationlattitude = location.lat();
                      destinationllongttitude = location.lng();

                      // Assuming you want to display these in the HTML
                    // document.getElementById('tr_latitude').textContent = ne.lat();
                    // document.getElementById('tr_longitude').textContent = ne.lng();
                    // document.getElementById('bl_latitude').textContent = sw.lat();
                    // document.getElementById('bl_longitude').textContent = sw.lng();
                    // document.getElementById('latitude').textContent = location.lat();
                    // document.getElementById('longitude').textContent = location.lng()
                    });
              }


                google.maps.event.addDomListener(window, 'load', initAutocomplete);    
          
                $(document).ready(function() {
                    $('.activity-box').click(function() {
                      // This will toggle the 'selected' class on and off when user click on an activity box
                      $(this).toggleClass('selected');
            });

            $(document).ready(function() {
              var today = new Date().toISOString().substring(0, 10);
              $('#startDate').val(today);
         });
      });


        function addDays(date, days) {
                  var result = new Date(date);
                  result.setDate(result.getDate() + days);
                  return result.toISOString().split('T')[0]; // Format the date as YYYY-MM-DD
                }



         function handleSubmit() {
                        // Capture form data
             var country = document.getElementById('input_place').value;
            var travelDate = document.getElementById('startDate').value;
            var numOfDays = document.getElementById('numDays').value;
            var numOfPeople = document.getElementById('peopleCount').value;
            var budget = document.getElementById('budgetSelect').value;
            var selectedActivities = Array.from(document.querySelectorAll('.activity-box.selected'))
                                        .map(box => box.getAttribute('data-activity'));


            // Create AllTravelDates array
              var AllTravelDates = [travelDate];
              for (var i = 1; i < numOfDays; i++) {
                  AllTravelDates.push(addDays(travelDate, i));
              }
                                   
                  // Create destination object
              var destination = {
                bl_lat: swLatitude,
                bl_lng: swLongitude,
                tr_lat: neLatitude,
                tr_lng: neLongitude
              };

            // Store data in session storage
            sessionStorage.setItem('tripData', JSON.stringify({
              "userID":18,
              destination,
              country,
              travelDate,
              numOfDays,
              AllTravelDates, 
              selectedActivities,
              budget,
              numOfPeople,
              destinationlattitude: destinationlattitude,
              destinationllongttitude: destinationllongttitude
            }));

            window.location.href = 'hotel.html';
          }
 </script>
</body>
</html>
