{% extends 'base.html' %} {% block title %}
<title>Sign-up</title>
{% endblock %} {% block css %}
<link
  href="{{url_for('static', filename='css/signInsignUP.css')}}"
  rel="stylesheet"
/>
<link
  href="{{url_for('static', filename='css/helper.css')}}"
  rel="stylesheet"
/>
{% endblock %} {% block body %}
<!-- ================ Sign up page ================ -->
<div class="sign-in-page pt-70 pb-70">
  <div class="container">
    <div class="row">
      <div class="col-lg-6 offset-lg-3 col-md-8 offset-md-2">
        <!-- sign in up box -->
        <div class="sign-in-up-box text-center">
          <h4 class="mb-8">Sign up your account</h4>
          <form
            id="signupForm"
            method="POST"
            class="mt-30"
          >
            <!-- Form fields -->
            <div class="mb-3">
              <input
                type="text"
                class="form-control"
                placeholder="User Name*"
                name="userName"
                id="userName"
                required
              />
            </div>
            <div class="mb-3">
              <input
                type="email"
                class="form-control"
                placeholder="Email*"
                name="email"
                id="email"
                required
              />
            </div>
            <div class="mb-3">
              <input
                type="text"
                class="form-control"
                placeholder="Phone*"
                name="phone"
                id="phone"
                required
              />
            </div>
            <div class="mb-3">
              <input
                type="password"
                class="form-control"
                placeholder="Password*"
                name="password"
                id="password"
                required
              />
            </div>
            <div class="mb-3">
              <input
                type="password"
                class="form-control"
                placeholder="Confirm Password*"
                name="confirmPassword"
                id="confirmPassword"
                required
              />
            </div>
            <div class="mb-3 form-check text-start"></div>
            <button class="btn-style-2 w-100 font-size-18 mt-20" type="submit">
              Sign Up
            </button>
          </form>
          <div id="liveAlertPlaceholder"></div>
          <div class="no-account mt-20">
            Already have an account?
            <a href="{{ url_for('login.index') }}">Sign In here</a>
          </div>
        </div>
        <!-- sign in up box end -->
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block js %}
<!-- js files -->
<script src="{{url_for('static', filename='js/bootstrap.bundle.min.js')}}"></script>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    // Get the form element
    const form = document.getElementById("signupForm");

    // Add event listener for form submission
    form.addEventListener("submit", function (event) {
      event.preventDefault(); // Prevent the default form submission
      // Perform AJAX request
      const formData = new FormData(this); // Use 'this' instead of 'form[0]' to reference the form element
      $.ajax({
        url: "/register", // Update the URL to match your Flask route
        method: "POST",
        processData: false, // Add this line to prevent jQuery from processing the data
        contentType: false, // Add this line to prevent jQuery from setting the content type
        data: formData, // Use the 'formData' variable instead of 'new FormData(form[0])'
        cache: false,
      })
        .then((response) => {
          // Handle the JSON response
          if (response.signUp === true) {
            // Additional actions when sign-up is successful
            appendAlert(`${response.message}, We will return you to the login page within five seconds`, 'primary')
            form.reset();
            form.hidden = true;
            setTimeout(() => {
              window.location.href = "{{ url_for('login.index') }}";
            }, 5000);
          } else {
            appendAlert(response.message, 'primary')
          }
        })
        .catch((error) => {
          console.error("Error:", error);
        });
    });

    const alertPlaceholder = document.getElementById("liveAlertPlaceholder");
    const appendAlert = (message, type) => {
      const wrapper = document.createElement("div");
      wrapper.innerHTML = [
        `<div class="alert alert-${type} alert-dismissible mt-5" role="alert">`,
        `   <div>${message}</div>`,
        '   <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>',
        "</div>",
      ].join("");

      alertPlaceholder.append(wrapper);
    };
  });
</script>
{% endblock %}
