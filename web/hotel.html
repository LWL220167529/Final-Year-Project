<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Choose your hotel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="assets/css/hotel.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto+Condensed&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="js/bootstrap.bundle.js"></script>
    <script src="https://kit.fontawesome.com/298191de6e.js" crossorigin="anonymous"></script>
   
</head>

<header class = "header">
    <img class  = "logo" src = "">
    <nav>
       <ul class = "nav_links">
           <li><a href = "index.html">Home</a></li>
           <li><a href = "planForm.html">Start Planning</a></li>
           <li><a href = "savedPlan.html">Saved Plan</a></li>
           <a class = "cta" href = "index.html"><button>Logout</button></a>
    </nav>
 </header>

 <body>
    <center><h1>Choose a hotel you would like to stay in</h1></center>
    <br>
    <br>
    <div class="container my-10">
        <div class="row align-items-start">
                <!-- Filter Sidebar -->
                <div class="col-md-4 filter-part">
                    <h5>Search by property name</h5>
                    <div class="mb-3">
                    <input type="text" id="searchInput" class="form-control" placeholder="e.g. Marriott">
                    </div>
                <h3>Filter by</h3>
                <!-- Popular Filters -->
                <div class="mb-3">
                    <!-- Checkbox filters -->
                </div>
    
                <h8>Price per night</h8>
                <div class="mb-3">
                    <!-- Price Range Slider -->
                    <div class="mb-3">
                        <div class="d-flex justify-content-between">
                            <input type="text" id="minPriceInput" class="form-control" placeholder="Min $0" aria-label="Minimum price" readonly>
                            
                        </div>
                        <input type="range" class="form-range" min="0" max="500" value ="0" id="minPriceRange">

                        <div class="d-flex justify-content-between">
                            <input type="text" id="maxPriceInput" class="form-control" placeholder="Max $600" aria-label="Maximum price" readonly>
                            
                        </div>
                        <input type="range" class="form-range" min="0" max="600" value ="600" id="maxPriceRange">
                    </div>
                    
                </div>
    
                <small>Guest rating</small>
                <br>
                <div class="mb-3">
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="guestRating" id="ratingAny" value="0" checked>
                        <label class="form-check-label" for="ratingAny">
                            Any
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="guestRating" id="ratingWonderful" value="9">
                        <label class="form-check-label" for="ratingWonderful">
                            Wonderful 9+
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="guestRating" id="ratingVeryGood" value="8">
                        <label class="form-check-label" for="ratingVeryGood">
                            Very good 8+
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="guestRating" id="ratingGood" value="7">
                        <label class="form-check-label" for="ratingGood">
                            Good 7+
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="guestRating" id="ratingPleasant" value="6">
                        <label class="form-check-label" for="ratingPleasant">
                            Pleasant 6+
                        </label>
                    </div>
                </div>
                
    
                <div class="mb-3">
                    <!-- Star Rating Checkboxes -->
                    <br>
                    <a href="results.html">
                        <button type="button" class="btn btn-primary">Next</button>
                    </a>
                </div>
            </div>
            <div class="col-8" id="hotel_items">
            </div>
         </div>
    </div>

    <script>

/*function selectCard() {
     $('.hotel-select').on('click', function() {
         // Toggle the visibility of other cards
        $(this).closest('.card').toggleClass('selected');
        if ($(this).closest('.card').hasClass('selected')) {
            // If the card is selected, hide others
            $('.card').not('.selected').hide();
            $(this).text('Deselect');

             // Log the selected hotel's data
             var hotelData = $(this).closest('.card').data('hotel');
            console.log('Selected Hotel:', hotelData);

        } else {
            // If deselected, show all cards
            $('.card').show();
            $(this).text('Select');
        }
      });
   }*/


$(document).ready(function() {
    var allHotels = [];
    var filteredHotels = [];
    var minPriceRange = $('#minPriceRange');
    var maxPriceRange = $('#maxPriceRange');
    var minPriceInput = $('#minPriceInput');
    var maxPriceInput = $('#maxPriceInput');

    $('#hotel_items').on('click', '.hotel-select', function() {
        var card = $(this).closest('.card');
        card.toggleClass('selected');
        if (card.hasClass('selected')) {
            // If the card is selected, hide others
            $('.card').not('.selected').hide();
            $(this).text('Deselect');
            // Log the selected hotel's data
            var hotelData = card.data('hotel');
            console.log('Selected Hotel:', hotelData);
        } else {
            // If deselected, show all cards
            $('.card').show();
            $(this).text('Select');
        }
    });

// Retrieve stored data from session storage
   /* var storedData = sessionStorage.getItem('tripData');
    var tripData = storedData ? JSON.parse(storedData) : null;

    console.log('Stored Data:', storedData);
    console.log('Trip Data:', tripData);*/

    function loadHotels() {
      // Use jQuery's getJSON method to load the data from the local JSON file
            $.getJSON('assets/api/hotel.json', function(data) {
                allHotels = data['data']['propertySearch']['properties'];
                filteredHotels = allHotels;
                createBootstrapCards(filteredHotels);
                selectCard();
            }).fail(function(jqXHR, textStatus, errorThrown) {
                console.error('Error loading hotel ' + textStatus);
                // Handle errors here
            });
         }
                /* if(tripData) {
                        const options = {
                            method: 'POST',
                            url: 'https://hotels4.p.rapidapi.com/properties/v2/list',
                            headers: {
                                'content-type': 'application/json',
                                'X-RapidAPI-Key': '9dd4a43e57msh580d6989141c77ep1f6a87jsn0b698a38873f',
                                'X-RapidAPI-Host': 'hotels4.p.rapidapi.com'
                            },
                            data: {
                                currency: 'USD',
                                locale: 'en_US',
                                destination: {
                                    coordinates: {
                                        latitude: tripData.destinationlattitude,
                                        longitude: tripData.destinationllongttitude
                                    }
                                },
                                checkInDate: calculateDate(tripData.travelDate),
                                checkOutDate: calculateDate(tripData.travelDate, parseInt(tripData.numOfDays)),
                                rooms: [
                                    {
                                        adults: parseInt(tripData.numOfPeople)
                                    }
                                ],
                                resultsStartingIndex: 0,
                                resultsSize: 12,
                                sort: 'RECOMMENDED',
                                filters: {
                                    guestRating: 45
                                }
                            }
                        };

        axios.request(options).then(function(response) {
            allHotels = response.data.data.propertySearch.properties;
            filteredHotels = allHotels;
            createBootstrapCards(filteredHotels);
            selectCard();
        }).catch(function(error) {
            console.error(error);
            // Handle errors here
        });
     }
    }*/

    // Function to calculate date based on a start date and an offset of days
     /*   function calculateDate(startDate, offsetDays = 0) {
        var date = new Date(startDate);
        date.setDate(date.getDate() + offsetDays);
        return {
            day: date.getDate(),
            month: date.getMonth() + 1, // JavaScript months are 0-indexed
            year: date.getFullYear()
        };
      }*/

    // Call loadHotels function to fetch and display hotels
    loadHotels();

    function createBootstrapCards(responseData) {
        let cardsHtml = '';

        responseData.forEach(property => {
            const hotelId = property.id; 
            const imageUrl = property.propertyImage?.image?.url || 'default-image-path.jpg';
            const imageDescription = property.propertyImage?.image?.description || 'No description available';
            const neighborhoodName = property.neighborhood?.name || 'Unknown neighborhood';
            const distanceValue = property.destinationInfo?.distanceFromDestination?.value || 'Unknown';
            const distanceUnit = property.destinationInfo?.distanceFromDestination?.unit || '';
            const priceLabel = property.mapMarker?.label || 'Unknown price';
            const offerText = property.offerBadge?.secondary?.text || 'No offer available';
            const rating = property.reviews?.score || 'No rating';
            const reviewCount = property.reviews?.total || 'No';

            cardsHtml += `
                <div class="card mb-3 h-100 hotelCard" style="max-width: 700px; data-hotel-id="${hotelId}>
                    <div class="row g-0">
                        <div class="col-md-4">
                            <img src="${imageUrl}" class="img-fluid rounded-start h-100" alt="${imageDescription}">
                        </div>
                        <div class="col-md-8 d-flex flex-column">
                            <div class="card-body d-flex flex-grow-1">
                                <div class="w-100">
                                    <h5 class="card-title">${property.name}</h5>
                                    <p class="card-text"><small class="text-muted">${neighborhoodName}, ${distanceValue} ${distanceUnit} from destination</small></p>
                                </div>
                            </div>
                            <div class="card-footer bg-white border-top-0">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="price">
                                        <small class="text-muted">Price/night :</small>
                                        <span class="badge bg-success">${priceLabel}</span>                          
                                    </div>
                                    <div class="rating d-flex flex-column">
                                        <span class="badge bg-primary">Rating: ${rating}</span>
                                    </div>
                                    <button type="button" class="btn btn-warning hotel-select">Select</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        });

        $('#hotel_items').html(cardsHtml);
    }

    // Function to apply filters
    function applyFilters() {
        const priceFilter = {
            min: parseInt(minPriceRange.val()),
            max: parseInt(maxPriceRange.val())
        };
        const ratingFilter = parseFloat($('input[name="guestRating"]:checked').val());
        const searchText = $('#searchInput').val().toLowerCase();

        var filteredHotels = allHotels.filter(hotel => {
            const price = parseInt(hotel.mapMarker?.label?.replace(/^\D+/g, '')) || 0;
            const rating = hotel.reviews?.score || 0;
            const name = hotel.name.toLowerCase();
            return name.includes(searchText) && rating >= ratingFilter && price >= priceFilter.min && price <= priceFilter.max;
        });

        createBootstrapCards(filteredHotels);
    }

    // Event listener for rating filter change
    $('input[name="guestRating"]').on('change', function() {
        applyFilters();
    });

    // Event listeners for price range changes
    minPriceRange.on('input', function() {
        minPriceInput.val('Min $' + $(this).val());
        applyFilters();
    });

    maxPriceRange.on('input', function() {
        maxPriceInput.val('Max $' + $(this).val());
        applyFilters();
    });

    // Event listener for the property name search
        $('#searchInput').on('input', function() {
        applyFilters();
    });

   
});

</script>
</body>
</html>