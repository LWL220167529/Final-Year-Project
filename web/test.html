<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="js/bootstrap.bundle.js"></script>

    <style>
        .counter-change:hover {
            background-color: #007bff;
            /* Bootstrap primary color for example */
            color: #fff;
        }
        body {
            height: 150vh;
        }
    </style>
</head>

<body>
    <div class="container my-10">
        <div class="">
            <div class="w-55 mx-auto">
                <form class="">
                    <div>
                        <div class="my-5">
                            <h4>What is your destination of choice?</h4> <!-- Corrected the closing tag -->
                        </div>
                        <div>
                            <input class="shadow-sm form-control form-control-lg w-100" list="placeList" type="text"
                                id="input_place" name="city" placeholder="City" />
                            <datalist id="placeList">
                            </datalist>
                        </div>
                    </div>
                    <hr class="my-8">
                    <div>
                        <div class="my-5">
                            <h4>When are you planning to travel?</h4>
                        </div>
                        <div>
                            <input type="date" class="shadow-sm form-control form-control-lg w-100" id="travel_date"
                                placeholder="Select Date">
                        </div>
                    </div>
                    <hr class="my-8">
                    <div class="flex items-center gap-2 mb-6">
                        <div class="my-5">
                            <h4>How many days are you planning to travel?</h4>
                        </div>
                        <div class="d-flex justify-content-between">
                            <div class="fs-5">Day</div>
                            <div class="d-flex justify-content-center align-items-center gap-3">
                                <button type="button" class="btn border rounded-circle  border-gray-400 counter-change"
                                    onclick="changeCount(-1, 'selectDays')"><span><i
                                            class="bi bi-dash-lg"></i></span></button>
                                <div class="text-center" id="selectDays">3</div>
                                <button type="button" class="btn border rounded-circle border-gray-400 counter-change"
                                    onclick="changeCount(1, 'selectDays')"><span><i
                                            class="bi bi-plus-lg"></i></span></button>
                            </div>
                        </div>
                        <hr class="my-8">
                        <div class="">
                            <h4>How many person on traveling?</h4>
                            <div class="my-5">
                                <a class="w-100 border rounded p-3" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#travelersInfo" aria-expanded="false" aria-controls="travelersInfo"
                                    data-adult-amount="2" data-child-amount="2" data-room-amount="1">
                                    2 人, 1 房
                                </a>
                            </div>
                            <div class="collapse" id="travelersInfo">
                                <div class="card card-body">
                                    <!-- Content for each traveler's details -->
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <span>成人</span>
                                            <div class="d-flex align-items-center gap-2">
                                                <button type="button" class="btn btn-outline-secondary rounded-circle"
                                                    onclick="changeCount(-1, 'adultCount')"><span><i
                                                            class="bi bi-dash-lg"></i></span></button>
                                                <span id="adultCount">2</span>
                                                <button type="button" class="btn btn-outline-secondary rounded-circle"
                                                    onclick="changeCount(1, 'adultCount')"><span><i
                                                            class="bi bi-plus-lg"></i></span></button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mb-4">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <span>小孩</span>
                                            <div class="d-flex align-items-center gap-2">
                                                <button type="button" class="btn btn-outline-secondary rounded-circle"
                                                    onclick="changeCount(-1, 'childCount')"><span><i
                                                            class="bi bi-dash-lg"></i></span></button>
                                                <span id="childCount">0</span>
                                                <button type="button" class="btn btn-outline-secondary rounded-circle"
                                                    onclick="changeCount(1, 'childCount')"><span><i
                                                            class="bi bi-plus-lg"></i></span></button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mb-3" id="roomSelect" style="display: none;">
                                        <select class="form-select" aria-label="Number of rooms">
                                            <option selected>1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                            <option value="5">5</option>
                                            <option value="6">6</option>
                                            <option value="7">7</option>
                                            <option value="8">8</option>
                                            <option value="9">9</option>
                                            <option value="10">10</option>
                                            <option value="11">11</option>
                                            <option value="12">12</option>
                                            <option value="13">13</option>
                                            <option value="14">14</option>
                                            <option value="15">15</option>
                                            <option value="16">16</option>
                                            <option value="17">17</option>
                                        </select>
                                    </div>
                                    <button type="button" class="btn btn-primary ms-auto" data-bs-toggle="collapse" data-bs-target="#travelersInfo" aria-expanded="false" aria-controls="travelersInfo" onclick="setPersonData()">Complete</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="border-top border-5 p-4 d-flex fixed-bottom bg-white">
        <div class="ms-auto">
            <button class="btn btn-primary px-5 py-3"><strong>Submit</strong></button>
        </div>
    </div>

    <script>
        function setPersonData() {
            var adultCount = document.getElementById('adultCount').textContent;
            var childCount = document.getElementById('childCount').textContent;
            var roomSelect = document.getElementById('roomSelect').querySelector('.form-select');
            var roomCount = roomSelect.value; // 获取选择的房间数

            // 更新显示的人数和房间数
            var travelersInfo = document.querySelector('[data-bs-target="#travelersInfo"]');
            travelersInfo.textContent = adultCount + ' 人, ' + roomCount + ' 房';

            // 更新data属性
            travelersInfo.setAttribute('data-adult-amount', adultCount);
            travelersInfo.setAttribute('data-child-amount', childCount);
        }

        function changeCount(change, elementId) {
            var element = document.getElementById(elementId);
            var currentCount = parseInt(element.textContent) || 0;
            currentCount += change;

            // Prevent negative number of people
            if (currentCount < 0) {
                currentCount = 0;
            }

            element.textContent = currentCount;

            // 如果是小孩數量的元素並且數量為0，隱藏房間選擇器
            if (elementId === 'childCount' && currentCount === 0) {
                document.getElementById('roomSelect').style.display = 'none';
            } else if (elementId === 'childCount' && currentCount > 0) {
                document.getElementById('roomSelect').style.display = 'block'; // 或者使用 'flex', 'grid' 等依據您的布局
            }
        }
        
        flatpickr("#travel_date", {
            dateFormat: "d-m-Y",
            minDate: "today"
        });
        var inputPlace = document.getElementById("input_place");
        var placeList = document.getElementById("placeList");
        var timeout = null; // 用於保存 timeout 的變量

        // 當 input 值改變時的事件處理函數
        inputPlace.addEventListener("input", function () {
            clearTimeout(timeout); // 清除已存在的 timeout
            var value = this.value;

            if (value === "") {
                placeList.innerHTML = "";
                return;
            }

            // 如果輸入值匹配 datalist 中的選項，則不執行 fetch
            if (isInputValueInDatalist(placeList, value)) {
                return;
            }

            // 設置延遲執行的 fetch 請求
            timeout = setTimeout(function () {
                fetch("http://159.223.94.246:5000/estimatePlace?city=" + encodeURIComponent(value))
                    .then((response) => response.json())
                    .then((data) => {
                        placeList.innerHTML = "";
                        data.forEach(function (obj) {
                            var option = document.createElement("option");
                            option.value = obj.message;
                            option.setAttribute('data-place-id', obj.key);
                            placeList.appendChild(option);
                        });
                    }).catch(function (error) {
                        console.error('Error fetching places:', error);
                    });
            }, 1500); // 延遲 1500 毫秒 (1.5 秒)
        });

        // 檢查輸入值是否在 datalist 中的函數
        function isInputValueInDatalist(datalist, inputValue) {
            return Array.from(datalist.options).some(function (option) {
                return option.value === inputValue;
            });
        }

        // 當按鍵按下時的事件處理函數
        inputPlace.addEventListener("keydown", function (event) {
            if (event.key === "Delete" || event.key === "Backspace") {
                // 如果 input 值為空，或者 input 值為 datalist 中的某個選項
                if (this.value === "" || isInputValueInDatalist(placeList, this.value)) {
                    this.value = ""; // 清空 input
                    placeList.innerHTML = ""; // 清空 datalist
                    event.preventDefault();
                }
            }
        });
    </script>


</body>



</html>